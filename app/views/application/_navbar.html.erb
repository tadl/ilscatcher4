<div class="container">
  <a class="navbar-brand" href="/">
    <%= image_tag(Settings.logo_icon, size: "30", class: "d-inline-block align-top", id: "brand-logo") %>
  </a>
  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>
  <div class="collapse navbar-collapse justify-content-stretch" id="navbarNav">
    <ul class="navbar-nav">
      <li class="nav-item<%= (request.path == index_path) ? ' active' : '' %>">
        <a class="nav-link" href="<%= index_path %>">Home <span class="sr-only">(current)</span></a>
      </li>
      <li class="nav-item<%= (request.path == search_path) ? ' active' : '' %>">
        <a class="nav-link" href="<%= search_path %>?new_search=true">Search</a>
      </li>
      <% if !Settings.added_nav_links.nil? %>
        <% Settings.added_nav_links.each do |link| %>
          <li class="nav-item">
            <a class="nav-link" href="<%= link['url'] %>"><%= link['name'] %></a>
          </li>
        <% end %>
      <% end %>
    </ul>
    <% if !cookies[:user].present? %>
      <div class="btn-group navbar-nav ml-auto">
        <a onclick="show_login_form()">
          <button type="button" class="btn btn-primary mr-1" id="account-button">
            Sign in
          </button>
        </a>
        <% if Settings.online_registration == true && Settings.register_link_show == true %>
          <a href="<%= Settings.register_link %>">
            <button type="button" class="btn btn-primary" id="register-button">
              <%= Settings.register_link_text %>
            </button>
          </a>
        <% end %>
      </div>
    <% else %>
      <ul class="navbar-nav ml-auto">
        <% userdetails = JSON.parse(cookies[:user]) %>
        <% if userdetails['checkouts'].to_i > 0 %>
          <li class="nav-item<%= (request.path == checkouts_path) ? ' active' : '' %>"><a href="<%= checkouts_path %>" class="nav-link">Checkouts <span class="badge badge-primary"><span id="user-checkouts"><%= userdetails['checkouts'] %></span></span></a></li>
        <% end %>
        <% if userdetails['holds'].to_i > 0 %>
          <li class="nav-item<%= (request.path == holds_path) ? ' active' : '' %>"><a href="<%= holds_path %>" class="nav-link">Holds <span class="badge badge-primary"><span id="user-holds"><%= userdetails['holds'] %></span></span></a></li>
        <% end %>
        <% if userdetails['holds_ready'].to_i > 0 %>
          <li class="nav-item<%= (request.path == holds_pickup_path) ? ' active' : '' %>"><a href="<%= holds_pickup_path %>" class="nav-link">Ready for Pickup <span class="badge badge-primary"><span id="user-holds-ready"><%= userdetails['holds_ready'] %></span></span></a></li>
        <% end %>
        <% if userdetails['fine'].to_f > 0 %>
          <li class="nav-item<%= (request.path == fines_path) ? ' active' : '' %>"><a href="<%= fines_path %>" class="nav-link">Fines <span class="badge badge-primary"><span id="user-fines"><%= userdetails['fine'] %></span></span></a></li>
        <% end %>
        <li class="nav-item pl-3"><a role="button" class="btn btn-primary" href="/preferences">My Account</a></li>
        <li class="nav-item pl-3"><button type="button" class="btn btn-default" id="logout-button" onclick="do_logout()">Log out</button></li>
      </ul>
    <% end %>
  </div>
</div>